<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ğŸŒ JSON å¤šè¯­è¨€æœ¬åœ°åŒ–ç¿»è¯‘å™¨</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --brand:#3b82f6;
  --ok:#10b981;
  --warn:#ef4444;
  --bg:#f8fafc;
  --card:#fff;
  --border:#e5e7eb;
  --text:#1f2937;
}
body{
  font-family:'Inter',sans-serif;
  background:var(--bg);
  margin:0;
  padding:40px 0;
  display:flex;
  justify-content:center;
}
.container{
  background:var(--card);
  border-radius:16px;
  box-shadow:0 8px 24px rgba(0,0,0,.05);
  padding:28px;
  max-width:1180px;
  width:100%;
}
h1{text-align:center;color:var(--brand);font-size:1.9rem;margin:0;}
label{font-weight:600;display:block;margin:16px 0 6px;}
textarea,input[type="text"],input[type="password"]{
  width:100%;
  border:1px solid var(--border);
  border-radius:10px;
  padding:10px;
  font-size:14px;
  font-family:monospace;
  transition:border-color .2s, box-shadow .2s;
}
textarea:focus,input:focus{
  outline:none;
  border-color:var(--brand);
  box-shadow:0 0 0 3px rgba(59,130,246,0.15);
}
textarea{min-height:160px;resize:vertical;}
.btn{
  display:inline-block;
  padding:10px 16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
  color:#fff;
  background:linear-gradient(90deg,var(--brand),#06b6d4);
  transition:transform .1s;
}
.btn:hover{transform:translateY(-1px);}
.btn:disabled{opacity:.6;cursor:not-allowed;}
.actions{margin-top:18px;display:flex;gap:10px;flex-wrap:wrap;}
.status{
  margin-top:14px;
  font-weight:500;
  padding:10px;
  border-radius:8px;
  background:#f1f5f9;
}
.status.ok{color:var(--ok);background:#ecfdf5;}
.status.warn{color:var(--warn);background:#fef2f2;}
.lang-card{
  border:1px solid var(--border);
  border-radius:10px;
  padding:12px;
  margin:12px 0;
  background:#fff;
}
.lang-card h3{margin:0 0 6px;color:var(--brand);}
.lang-card pre{
  background:#f9fafb;
  padding:10px;
  border-radius:8px;
  max-height:240px;
  overflow:auto;
  font-size:13px;
}
.lang-card a{
  display:inline-block;
  margin-top:6px;
  color:var(--brand);
  text-decoration:none;
  font-size:13px;
}
#downloadAll{
  background:var(--ok);
}
</style>
</head>
<body>

<div class="container">
  <h1>ğŸŒ JSON å¤šè¯­è¨€æœ¬åœ°åŒ–ç¿»è¯‘å™¨</h1>

  <label>API Keyï¼š</label>
  <input type="password" id="userApiKey" placeholder="API-KEY" />

  <label>æº JSONï¼š</label>
  <textarea id="sourceJSON" placeholder="ç²˜è´´ä½ çš„ JSON æˆ–ç‚¹å‡»ä¸Šä¼ æŒ‰é’®"></textarea>
  <input type="file" id="uploadFile" accept=".json" style="margin-top:6px;" />

  <label>æœ€ä½³ç¿»è¯‘å‚è€ƒï¼š</label>
  <input type="text" id="bestExample" placeholder="ä¾‹å¦‚ï¼šAI Stem Splitter" />

  <div class="actions">
    <button id="runBtn" class="btn">ğŸš€ å¼€å§‹ç¿»è¯‘ï¼ˆ9ç§è¯­è¨€ï¼‰</button>
    <button id="downloadAll" class="btn">â¬‡ ä¸‹è½½å…¨éƒ¨ ZIP</button>
  </div>

  <div id="status" class="status">å¾…ç¿»è¯‘</div>
  <div id="output"></div>
</div>

<script>
const API = "https://fast-chat-worker.ne0s0u1-pd.workers.dev"; 
const langs = ["zh","ja","de","pt","es","fr","ko","tw","vi"];
const el = {
  runBtn: document.getElementById("runBtn"),
  output: document.getElementById("output"),
  status: document.getElementById("status"),
  apiKey: document.getElementById("userApiKey"),
  src: document.getElementById("sourceJSON"),
  best: document.getElementById("bestExample"),
};

// ä¿å­˜/åŠ è½½ key
el.apiKey.value = localStorage.getItem("apicore_user_key") || "";
el.apiKey.addEventListener("input", ()=>localStorage.setItem("apicore_user_key",el.apiKey.value));

document.getElementById("uploadFile").addEventListener("change", e=>{
  const f = e.target.files[0];
  if(!f) return;
  const r = new FileReader();
  r.onload = ()=>{ el.src.value = r.result; };
  r.readAsText(f);
});

async function translateAll(){
  const jsonText = el.src.value.trim();
  const bestExample = el.best.value.trim();
  const userApiKey = el.apiKey.value.trim();
  if(!jsonText || !userApiKey){
    alert("è¯·å¡«å†™ JSON ä¸ API Key");
    return;
  }

  el.runBtn.disabled = true;
  el.status.textContent = "ğŸš§ æ­£åœ¨å¹¶å‘ç¿»è¯‘ 9 ç§è¯­è¨€...";
  el.output.innerHTML = "";

  const res = await fetch(API,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({jsonText,bestExample,userApiKey,langs})
  });

  const data = await res.json();
  if(data.error){ el.status.className="status warn"; el.status.textContent="âŒ "+data.error; el.runBtn.disabled=false; return; }

  renderResults(data.results);
  el.status.className="status ok";
  el.status.textContent="âœ… ç¿»è¯‘å®Œæˆ";
  el.runBtn.disabled=false;
}

function renderResults(results) {
  const out = el.output;
  out.innerHTML = "";

  for (const [lang, raw] of Object.entries(results)) {
    const content = cleanFence(raw);
    const div = document.createElement("div");
    div.className = "lang-card";
    div.innerHTML = `
      <h3>${lang.toUpperCase()}</h3>
      <pre>${escapeHTML(content)}</pre>
      <a download="${lang}.json" href="data:application/json;charset=utf-8,${encodeURIComponent(content)}">
        â¬‡ ä¸‹è½½ ${lang}.json
      </a>
    `;
    out.appendChild(div);
  }

  // æ¸…é™¤ Markdown ä»£ç å—åŒ…è£¹
  function cleanFence(text) {
    return String(text || "")
      .replace(/^```(?:json)?\s*/i, "")   // å»æ‰å¼€å¤´ ```json
      .replace(/```+$/i, "")              // å»æ‰æ‰€æœ‰ç»“å°¾ ```
      .trim();
  }

  // é˜²æ­¢ JSON ä¸­çš„ç¬¦å·è¢«å½“æˆ HTML
  function escapeHTML(str) {
    return str
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;");
  }
}


document.getElementById("runBtn").addEventListener("click",translateAll);

// ä¸‹è½½æ‰€æœ‰
document.getElementById("downloadAll").addEventListener("click", async ()=>{
  const cards = document.querySelectorAll(".lang-card pre");
  if(cards.length===0){alert("æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹");return;}
  const zip = await createZip();
  const blob = await zip.generateAsync({type:"blob"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "translations.zip";
  a.click();
});

// è½»é‡çº§ JSZip ç›´æ¥å¼•å…¥ CDN
async function createZip(){
  if(typeof JSZip==="undefined"){
    await import("https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js");
  }
  const zip = new JSZip();
  document.querySelectorAll(".lang-card pre").forEach(pre=>{
    const lang = pre.previousElementSibling.textContent.trim();
    zip.file(`${lang}.json`, pre.textContent);
  });
  return zip;
}
</script>

</body>
</html>
