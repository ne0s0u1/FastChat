<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Fast Chat</title>
<style>
  body {
    font-family: "Segoe UI", sans-serif;
    background: #f7f8fa;
    margin: 0; padding: 40px 20px;
    display: flex; flex-direction: column; align-items: center;
  }
  h1 { margin: 0 0 12px; color: #2563eb; }
  .row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-bottom: 10px; }
  label { font-weight: 600; }
  input[type="password"] {
    padding: 8px 12px; border-radius: 8px; border: 1px solid #ccc; min-width: 280px;
  }
  textarea {
    width: 100%; max-width: 820px; min-height: 160px;
    padding: 12px; font-size: 15px;
    border: 1px solid #ccc; border-radius: 8px; resize: vertical;
  }
  button {
    margin-top: 10px; padding: 10px 16px;
    font-weight: 600; border: none; border-radius: 8px;
    background: #2563eb; color: #fff; cursor: pointer;
  }
  button:hover { background: #1d4ed8; }
  pre {
    width: 100%; max-width: 820px;
    background: #fff; border: 1px solid #ddd;
    border-radius: 8px; padding: 12px;
    white-space: pre-wrap; word-wrap: break-word;
    overflow-y: auto; max-height: 70vh;
    font-family: "JetBrains Mono", monospace;
  }
</style>
</head>
<body>
  <h1>⚡ Fast Chat</h1>

  <div class="row">
    <label>API Key：</label>
    <input type="password" id="userApiKey" placeholder="sk-..." />
  </div>

  <textarea id="prompt" placeholder="输入提示词..."></textarea>
  <button id="sendBtn">发送</button>
  <pre id="output">（等待输入）</pre>

<script>
const API = "https://fast-chat-worker.ne0s0u1-pd.workers.dev"; // 例如 https://fastchat.ne0s0u1.workers.dev

const promptEl = document.getElementById("prompt");
const keyEl = document.getElementById("userApiKey");
const outputEl = document.getElementById("output");
const sendBtn = document.getElementById("sendBtn");

// 从本地存储恢复 key
keyEl.value = localStorage.getItem("user_api_key") || "";
keyEl.addEventListener("input", () => {
  localStorage.setItem("user_api_key", keyEl.value);
});

sendBtn.addEventListener("click", async () => {
  const prompt = promptEl.value.trim();
  const key = keyEl.value.trim();
  if (!prompt) return alert("请输入提示词");
  if (!key.startsWith("sk-")) return alert("请输入有效的 API Key");

  outputEl.textContent = "⏳ 正在请求...";
  sendBtn.disabled = true;

  try {
    const res = await fetch(API, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text: prompt, userApiKey: key })
    });

    if (!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();
    outputEl.textContent = data.reply || JSON.stringify(data, null, 2);
  } catch (err) {
    outputEl.textContent = "❌ 错误：" + err.message;
  } finally {
    sendBtn.disabled = false;
  }
});
</script>
</body>
</html>
